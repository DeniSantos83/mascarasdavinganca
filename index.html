<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>A MANSÃO — Livro-jogo</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <canvas id="rain"></canvas>
  <div id="lightning" aria-hidden="true"></div>

  <header class="topbar">
    <div class="brand">
      <div class="title">A MANSÃO</div>
      <div class="subtitle">Livro-jogo • sem voltar • sem reset no refresh</div>
    </div>

    <div class="hud">
      <div class="hud__row">
        <div class="hud__item"><span class="k">Nome</span><span class="v" id="hudName">—</span></div>
        <div class="hud__item"><span class="k">Cena</span><span class="v" id="hudScene">—</span></div>
      </div>

      <div class="hud__row">
        <div class="hud__item"><span class="k">HABIL</span><span class="v" id="hudSkill">—</span></div>
        <div class="hud__item"><span class="k">VIGOR</span><span class="v" id="hudStam">—</span></div>
        <div class="hud__item"><span class="k">SORTE</span><span class="v" id="hudLuck">—</span></div>
        <div class="hud__item"><span class="k">MEDO</span><span class="v" id="hudFear">—</span></div>
      </div>
    </div>

    <div class="actions">
      <button class="btn btn--ghost" id="btnRules" type="button">Regras</button>
      <button class="btn btn--danger" id="btnRestart" type="button">Recomeçar</button>
    </div>
  </header>

  <main class="wrap">
    <section class="panel" id="screenCreate" hidden>
      <h1>Criar personagem</h1>
      <p class="muted">Role os dados e monte sua ficha. O jogo salva automaticamente no seu navegador.</p>

      <div class="grid">
        <label class="field">
          <span>Nome</span>
          <input id="inpName" type="text" placeholder="Digite seu nome..." autocomplete="off" />
        </label>

        <div class="field">
          <span>HABILIDADE (máx)</span>
          <div class="row">
            <input id="inpSkillMax" type="number" min="0" readonly />
            <button class="btn" id="rollSkill" type="button">Rolar 1d6 + 6</button>
          </div>
          <small class="hint">Você começa sem arma: HABILIDADE Inicial = HABILIDADE − 3</small>
        </div>

        <div class="field">
          <span>HABILIDADE (inicial / desarmado)</span>
          <input id="inpSkillCur" type="number" min="0" readonly />
        </div>

        <div class="field">
          <span>RESISTÊNCIA (máx)</span>
          <div class="row">
            <input id="inpStamMax" type="number" min="0" readonly />
            <button class="btn" id="rollStam" type="button">Rolar 1d6 + 12</button>
          </div>
        </div>

        <div class="field">
          <span>RESISTÊNCIA (atual)</span>
          <input id="inpStamCur" type="number" min="0" readonly />
        </div>

        <div class="field">
          <span>SORTE (máx)</span>
          <div class="row">
            <input id="inpLuckMax" type="number" min="0" readonly />
            <button class="btn" id="rollLuck" type="button">Rolar 1d6 + 6</button>
          </div>
        </div>

        <div class="field">
          <span>SORTE (atual)</span>
          <input id="inpLuckCur" type="number" min="0" readonly />
        </div>

        <div class="field">
          <span>MEDO (máx)</span>
          <div class="row">
            <input id="inpFearMax" type="number" min="0" readonly />
            <button class="btn" id="rollFear" type="button">Rolar 1d6 + 6</button>
          </div>
          <small class="hint">MEDO começa em 0 e vai subindo. Se atingir o máximo, você morre de medo.</small>
        </div>

        <div class="field">
          <span>MEDO (atual)</span>
          <input id="inpFearCur" type="number" min="0" readonly />
        </div>
      </div>

      <div class="footerRow">
        <button class="btn btn--primary" id="btnStart" type="button">Começar a aventura</button>
        <div class="diceLog" id="diceLog" aria-live="polite"></div>
      </div>
      <details class="intro" id="introBox">
        <summary>Introdução (leia antes de começar)</summary>
        <pre class="intro__text">A chuva espirra implacavelmente no para-brisa. Você
não consegue ver mais do que uma penumbra aquosa enquanto se esforça
para enxergar a estrada
à frente, debruçado sobre o volante. Embora os limpadores de para-brisa batam bravamente, estão
travando uma batalha perdida, pois a chuva cai cada vez mais forte.
Você tira o pé do acelerador; os faróis
lutam para iluminar a estrada.

Droga! Você amaldiçoa o velho de cabelos brancos que
o mandou seguir por essa estrada esburacada. Provavelmente ele
se referia à segunda entrada à esquerda — ou até mesmo à direita.
O velho tolo. Talvez essa seja a ideia dele de uma
piada. Afinal, você não notou um brilho travesso
em seus olhos? Algo vagamente sinistro?

Mas que tipo de bobagem é essa? Então você fez uma
entrada errada e foi pego em um aguaceiro na
noite. A chuva vai diminuir em breve — não é possível
que continue com esse dilúvio por muito tempo — e então você poderá
... CUIDADO!

Você vira o volante freneticamente para a esquerda para evitar a
figura que, do nada, surge nos faróis.

O carro sacode e chacoalha ao passar
pela beira da estrada rochosa e cair em uma vala.

Você tenta se recompor. Você está ileso, mas
abalado. Então você se lembra do que aconteceu.
O corpo! Você deve ter atropelado a figura que
apareceu; não havia como
evitá-la. Você salta do carro, rezando para que
ele ainda esteja vivo.

Suas roupas encharcam a chuva enquanto você manca de volta para a
estrada. Na escuridão, é difícil enxergar qualquer coisa.

Mas não há sinal de um corpo!

Você avalia a situação. Tem certeza de que
era alguém e não um truque da luz? Sim. Você
se lembra dos braços erguidos em pânico quando o carro
colidiu, e da expressão de angústia em seu rosto. Seu
rosto! Havia algo familiar naquele rosto. Um
homem que você reconheceu. Um velho; com
granizo branco
Seu coração dispara: não, impossível! Com um arrepio de medo,
você corre de volta para o carro, pula para dentro, força a chave
na ignição e a gira violentamente! O motor de arranque
tosse, engasga e morre.

Você gira a chave novamente, mas desta vez um único tremor
é tudo o que o motor consegue fazer. Você agarra o volante
com as mãos e o sacode desesperadamente como se tentasse
dar vida ao carro. Mas a bateria está descarregada.

Seu carro certamente não sairá da vala
esta noite.

Sua situação é desesperadora. Mas agora a situação do
seu carro é primordial. Onde você pode conseguir ajuda? Você
passou por uma oficina em Mingleford, mas ficava a uns
32 quilômetros de distância.
Como se em resposta, uma luz aparece à distância.

Alguém acendeu a luz do quarto. Que
sorte! Fazia pelo menos vinte e quatro quilômetros que
você tinha passado pela última casa e por acaso
você quebrou bem perto da casa de alguém.

Você abotoa o casaco e abre a porta. De
fora do carro, você consegue ver o prédio com mais
claridade. Logo à frente, à esquerda, uma estrada serpenteia até uma
casa grande. São uns bons cinco minutos de caminhada.

E quando você chegar lá, estará encharcado.

Mas como mais você vai ligar para a oficina? Você não pode
perder o compromisso de amanhã. Não, você precisa ir. De qualquer forma, você provavelmente conseguirá se secar
lá dentro depois de ligar para a oficina.

Você bate a porta, levanta a gola do casaco e parte para a
casa. Um relâmpago ilumina tudo claramente para você,
mas, em sua preocupação com a chuva, o
aviso vindo de cima passa despercebido. A casa é
antiga — muito antiga — e está em um estado deplorável de conservação. A
luz na janela está piscando. Provavelmente uma lamparina a óleo,
certamente não elétrica. E você não percebe um
fato que poderia tê-lo feito desistir:
não há linha telefônica na casa.

Ao subir os degraus até a porta da frente, você mal imagina
o que o destino lhe reserva.

Esta noite será uma noite inesquecível...</pre>
      </details>

    </section>

    <section class="panel" id="screenGame" hidden>
      <div class="sceneHead">
        <h1 id="sceneTitle">Cena</h1>
        <p class="muted" id="sceneMeta"></p>
      </div>

      <article class="sceneText" id="sceneText"></article>

      <div class="choices" id="choices"></div>

      <div class="tools">
        <button class="btn btn--ghost" id="btnTestLuck" type="button">Testar Sorte (2d6)</button>
        <button class="btn btn--ghost" id="btnAddFear" type="button">+1 Medo</button>
        <button class="btn btn--ghost" id="btnHeal" type="button">+2 Vigor</button>
      </div>

      <p class="muted tiny">
        Dica: o jogo salva automaticamente. Atualizar a página mantém seu progresso.
      </p>
    </section>
  </main>

  <dialog id="dlgRules">
    <div class="dlg">
      <div class="dlg__head">
        <h2>Regras rápidas</h2>
        <button class="btn btn--ghost" id="btnCloseRules" type="button">Fechar</button>
      </div>
      <div class="dlg__body">
        <p><b>HABILIDADE</b> reflete sua experiência em combate. <b>RESISTÊNCIA</b> (VIGOR) indica quanto você aguenta. <b>SORTE</b> indica o quão sortudo você é.</p>
        <p><b>Medo:</b> começa em 0 e sobe. Se o MEDO atual atingir o MEDO máximo, você morre de medo.</p>

        <h3>Batalhas (resumo)</h3>
        <ol>
          <li>Role 2d6 para a criatura e some a HABILIDADE dela = Força de Ataque.</li>
          <li>Role 2d6 para você e some sua HABILIDADE atual = sua Força de Ataque.</li>
          <li>Quem tiver maior Força, fere (2 de dano). Empate: próxima rodada.</li>
          <li>Você pode <b>Testar Sorte</b> após um ferimento para aumentar dano (se você feriu) ou reduzir dano (se você foi ferido). Cada teste reduz sua SORTE atual em 1.</li>
          <li>Se RESISTÊNCIA chegar a 0, você morre.</li>
        </ol>

        <p class="muted tiny">Texto e numeração do livro-jogo foram importados do seu arquivo .odt.</p>
      </div>
    </div>
  </dialog>

  <script src="game.js"></script>
</body>
</html>
